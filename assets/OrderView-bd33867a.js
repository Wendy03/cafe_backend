import{m as T,a as w,_ as g,o as c,c as m,b as e,F as O,l as P,t as d,j as y,v as k,r as a,d as l,w as $,n as f,e as C}from"./index-b7acc520.js";import{s as E}from"./statusStore-5a9e1e1d.js";import{c as x}from"./cartStore-ed590f1f.js";import{T as V}from"./Toast-14418d70.js";const U={data(){return{coupon_code:""}},methods:{...T(x,["getCarts","addCouponCode"])},computed:{...w(x,["cart"])},mounted(){this.getCarts()}},D={class:"col-lg-4"},A={class:"border p-4 mb-4 bg-light"},I=["src","alt"],L={class:"w-100"},S={class:"d-flex justify-content-between"},j={class:"mb-0 fw-bold"},F={class:"mb-0"},N={class:"mb-0 fw-bold"},q={class:"table mt-4 border-top border-bottom text-muted"},B=e("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"}," 小計 ",-1),H={class:"text-end border-0 px-0 pt-4"},M=e("tr",null,[e("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"}," 付款方式 "),e("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1),R={class:"input-group mb-3 input-group-sm"},z={class:"input-group-append"},G={class:"d-flex justify-content-between mt-4"},J=e("p",{class:"mb-0 h4 fw-bold"},"總計",-1),K={class:"mb-0 h4 fw-bold"};function Q(r,s,u,p,o,b){return c(),m("div",D,[e("div",A,[(c(!0),m(O,null,P(r.cart.carts,t=>(c(),m("div",{key:t.id,class:"d-flex mb-2"},[e("img",{src:t.product.imageUrl,alt:t.product.title,class:"me-2",style:{width:"48px",height:"48px","object-fit":"cover"}},null,8,I),e("div",L,[e("div",S,[e("p",j,d(t.product.title),1),e("p",F,"NT$ "+d(t.product.price),1)]),e("p",N,"x "+d(t.qty),1)])]))),128)),e("table",q,[e("tbody",null,[e("tr",null,[B,e("td",H,"NT$"+d(r.cart.total),1)]),M])]),e("div",R,[y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>o.coupon_code=t),placeholder:"請輸入優惠碼"},null,512),[[k,o.coupon_code]]),e("div",z,[e("button",{class:"btn btn-outline-primary",type:"button",onClick:s[1]||(s[1]=t=>r.addCouponCode(o.coupon_code))}," 套用優惠碼 ")])]),e("div",G,[J,e("p",K,"NT$"+d(r.cart.final_total),1)])])])}const W=g(U,[["render",Q]]),{VITE_API:X,VITE_PATH:Y}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/cafe_backend/",MODE:"production",DEV:!1,PROD:!0},Z={data(){return{form:{user:{name:"",email:"",tel:"",address:""},message:""},isProcessing:!1}},methods:{createOrder(){this.isProcessing=!0;const r=this.form;this.$http.post(`${X}/api/${Y}/order`,{data:r}).then(s=>{const{message:u,orderId:p}=s.data;this.isProcessing=!1,this.$refs.form.resetForm(),V.fire({title:`${u}`,icon:"success"}),this.$router.push(`/checkout/${p}`)}).catch(()=>{this.isProcessing=!1,V.fire({title:"無法新增資料，稍後再試",icon:"error"})})}}},ee={class:"col-lg-6"},se=e("h3",{class:"mb-3"},"客戶資訊",-1),oe={class:"mb-3"},te=e("label",{for:"email",class:"form-label"},"Email",-1),le={class:"mb-3"},re=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ne={class:"mb-3"},ae=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ie={class:"mb-3"},de=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ce={class:"mb-3"},me=e("label",{for:"message",class:"form-label"},"留言",-1),ue={class:"d-flex mt-4 justify-content-between align-items-md-center align-items-end w-100"},pe=e("i",{class:"fas fa-chevron-left me-2"},null,-1),_e={class:"text-end"},fe=["disabled"];function be(r,s,u,p,o,b){const t=a("v-field"),i=a("error-message"),h=a("router-link"),v=a("v-form");return c(),m("div",ee,[se,l(v,{ref:"form",onSubmit:b.createOrder},{default:$(({errors:_})=>[e("div",oe,[te,l(t,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":_.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":s[0]||(s[0]=n=>o.form.user.email=n)},null,8,["class","modelValue"]),l(i,{name:"email",class:"invalid-feedback"})]),e("div",le,[re,l(t,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":_.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":s[1]||(s[1]=n=>o.form.user.name=n)},null,8,["class","modelValue"]),l(i,{name:"姓名",class:"invalid-feedback"})]),e("div",ne,[ae,l(t,{id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":_.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10|numeric",modelValue:o.form.user.tel,"onUpdate:modelValue":s[2]||(s[2]=n=>o.form.user.tel=n)},null,8,["class","modelValue"]),l(i,{name:"電話",class:"invalid-feedback"})]),e("div",ie,[de,l(t,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":_.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":s[3]||(s[3]=n=>o.form.user.address=n)},null,8,["class","modelValue"]),l(i,{name:"地址",class:"invalid-feedback"})]),e("div",ce,[me,y(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=n=>o.form.message=n)},null,512),[[k,o.form.message]])]),e("div",ue,[e("div",null,[l(h,{to:"/cart",class:"text-dark mt-6"},{default:$(()=>[pe,C("回購物車")]),_:1})]),e("div",_e,[e("button",{type:"submit",class:"btn btn-primary",disabled:o.isProcessing}," 送出訂單 ",8,fe)])])]),_:1},8,["onSubmit"])])}const he=g(Z,[["render",be]]),ve={data(){return{}},components:{OrderForm:he,OrderDetail:W},computed:{...w(E,["isLoading"])}},ge={class:"container mt-5"},$e={class:"row flex-row-reverse justify-content-center pb-5"};function xe(r,s,u,p,o,b){const t=a("VueLoading"),i=a("OrderDetail"),h=a("OrderForm");return c(),m("div",ge,[l(t,{active:r.isLoading,"onUpdate:active":s[0]||(s[0]=v=>r.isLoading=v)},null,8,["active"]),e("div",$e,[l(i),l(h)])])}const Te=g(ve,[["render",xe]]);export{Te as default};
