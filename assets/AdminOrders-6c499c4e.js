import{T as h}from"./Toast-e0cddcce.js";import{m as C,A as V}from"./modalMixin-1883defe.js";import{_ as x,o as i,c as r,b as e,t as o,n as P,F as p,l as v,j as w,G as L,q as y,e as $,r as f,d as O}from"./index-71aea837.js";const A={props:{order:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{},tempOrder:{}}},mixins:[C],watch:{order(){this.tempOrder=this.order}}},D={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog modal-xl",role:"document"},T={class:"modal-content border-0"},U=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},I={class:"row"},j={class:"col-md-4"},q=e("h3",null,"用戶資料",-1),N={class:"table"},F=e("th",{style:{width:"100px"}},"姓名",-1),H=e("th",null,"Email",-1),R=e("th",null,"電話",-1),S=e("th",null,"地址",-1),z={class:"col-md-8"},G=e("h3",null,"訂單細節",-1),J={class:"table"},K=e("th",{style:{width:"100px"}},"訂單編號",-1),Q=e("th",null,"下單時間",-1),W=e("th",null,"付款狀態",-1),X=e("th",null,"總金額",-1),Y=e("h3",null,"選購商品",-1),Z={class:"table"},ee=e("thead",null,[e("tr")],-1),te={class:"text-end"},se={class:"d-flex justify-content-end"},oe={class:"form-check"},le=["id"],de=["for"],ne={class:"modal-footer"},ie=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),re=["disabled"],ae={key:0,class:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"};function ce(l,d,n,a,t,c){var u,m,b,g;return i(),r("div",D,[e("div",E,[e("div",T,[U,e("div",B,[e("div",I,[e("div",j,[q,e("table",N,[e("tbody",null,[e("tr",null,[F,e("td",null,o((u=t.tempOrder.user)==null?void 0:u.name),1)]),e("tr",null,[H,e("td",null,o((m=t.tempOrder.user)==null?void 0:m.email),1)]),e("tr",null,[R,e("td",null,o((b=t.tempOrder.user)==null?void 0:b.tel),1)]),e("tr",null,[S,e("td",null,o((g=t.tempOrder.user)==null?void 0:g.address),1)])])])]),e("div",z,[G,e("table",J,[e("tbody",null,[e("tr",null,[K,e("td",null,o(t.tempOrder.id),1)]),e("tr",null,[Q,e("td",null,o(l.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[W,e("td",null,[e("p",{class:P({"text-success":t.tempOrder.is_paid})},o(t.tempOrder.is_paid?"已付款":"尚未付款"),3)])]),e("tr",null,[X,e("td",null,o(l.$filters.currency(t.tempOrder.total)),1)])])]),Y,e("table",Z,[ee,e("tbody",null,[(i(!0),r(p,null,v(t.tempOrder.products,s=>(i(),r("tr",{key:s.id},[e("th",null,o(s.product.title),1),e("td",null,o(s.qty)+" / "+o(s.product.unit),1),e("td",te,o(l.$filters.currency(s.final_total)),1)]))),128))])]),e("div",se,[e("div",oe,[w(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"{tempOrder.id}","onUpdate:modelValue":d[0]||(d[0]=s=>t.tempOrder.is_paid=s)},null,8,le),[[L,t.tempOrder.is_paid]]),e("label",{class:"form-check-label",for:"{tempOrder.id}"},[e("span",null,o(t.tempOrder.is_paid?"已付款":"未付款"),1)],8,de)])])])])]),e("div",ne,[ie,e("button",{type:"button",class:"btn btn-primary",disabled:n.isProcessing,onClick:d[1]||(d[1]=s=>l.$emit("update-order",t.tempOrder))},[n.isProcessing?(i(),r("span",ae)):y("",!0),$(" 修改付款狀態 ")],8,re)])])])],512)}const ue=x(A,[["render",ce]]),_e={props:{order:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{}}},mixins:[C]},he={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},pe={class:"modal-dialog"},me={class:"modal-content border-0"},be=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ge={class:"modal-body"},fe={class:"text-danger mb-3"},Oe=e("h5",null,"選購商品",-1),ye={class:"table-responsive"},$e={class:"table"},ve=e("thead",null,[e("tr")],-1),Me={class:"text-end"},ke={class:"modal-footer"},Pe=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),xe=["disabled"];function Ce(l,d,n,a,t,c){return i(),r("div",he,[e("div",pe,[e("div",me,[be,e("div",ge,[$(" 是否刪除 "),e("strong",fe,o(n.order.id),1),$(" 訂單 "),Oe,e("div",ye,[e("table",$e,[ve,e("tbody",null,[(i(!0),r(p,null,v(n.order.products,u=>(i(),r("tr",{key:u.id},[e("th",null,o(u.product.title),1),e("td",null,o(u.qty)+" / "+o(u.product.unit),1),e("td",Me,o(l.$filters.currency(u.final_total)),1)]))),128))])])]),$(" (刪除後將無法恢復)。 ")]),e("div",ke,[Pe,e("button",{type:"button",class:"btn btn-danger",disabled:n.isProcessing,onClick:d[0]||(d[0]=u=>l.$emit("del-order"))}," 確認刪除 ",8,xe)])])])],512)}const we=x(_e,[["render",Ce]]),{VITE_API:M,VITE_PATH:k}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/cafe_backend/",MODE:"production",DEV:!1,PROD:!0},Le={data(){return{orders:[],tempOrder:{},pagination:{},isLoading:!1,isProcessing:!1}},components:{AdminPagination:V,OrderModal:ue,DelOrderModal:we},methods:{getOrders(l=1){this.isLoading=!0,this.$http.get(`${M}/api/${k}/admin/orders?page=${l}`).then(d=>{const{orders:n,pagination:a}=d.data;this.isLoading=!1,this.orders=n,this.pagination=a}).catch(d=>{var a,t;const n=((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.message)||"資料錯誤";this.isLoading=!1,h.fire({title:`${n}`,icon:"error"})})},openModal(l,d){l==="edit"?(this.tempOrder={...d},this.$refs.orderModal.showModal()):l==="del"&&(this.tempOrder={...d},this.$refs.delOrderModal.showModal())},updateOrder(l){const d={is_paid:l.is_paid};this.isProcessing=!0,this.$http.put(`${M}/api/${k}/admin/order/${l.id}`,{data:d}).then(n=>{h.fire({title:`${n.data.message}`,icon:"success"}),this.$refs.orderModal.hideModal(),this.isProcessing=!1,this.getOrders()}).catch(n=>{var t,c;this.isProcessing=!1;const a=((c=(t=n.response)==null?void 0:t.data)==null?void 0:c.message)||"資料錯誤";h.fire({title:`${a}`,icon:"error"})})},delOrder(){this.isProcessing=!0,this.$http.delete(`${M}/api/${k}/admin/order/${this.tempOrder.id}`).then(l=>{h.fire({title:`${l.data.message}`,icon:"success"}),this.$refs.delOrderModal.hideModal(),this.isProcessing=!1,this.getOrders()}).catch(l=>{var n,a;this.isProcessing=!1;const d=((a=(n=l.response)==null?void 0:n.data)==null?void 0:a.message)||"資料錯誤";h.fire({title:`${d}`,icon:"error"})})}},mounted(){this.getOrders()}},Ve={class:"table-responsive"},Ae={class:"table mt-4"},De=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Ee=["textContent"],Te={class:"list-unstyled"},Ue={class:"text-right"},Be={class:"form-check form-switch"},Ie=["id","onUpdate:modelValue","onChange"],je=["for"],qe={class:"btn-group"},Ne=["onClick"],Fe=["onClick"];function He(l,d,n,a,t,c){const u=f("VueLoading"),m=f("AdminPagination"),b=f("OrderModal"),g=f("DelOrderModal");return i(),r("div",null,[O(u,{active:t.isLoading,"onUpdate:active":d[0]||(d[0]=s=>t.isLoading=s)},null,8,["active"]),e("div",Ve,[e("table",Ae,[De,e("tbody",null,[(i(!0),r(p,null,v(t.orders,s=>(i(),r(p,{key:s.id},[t.orders.length?(i(),r("tr",{key:0,class:P({"text-gray":!s.is_paid})},[e("td",null,o(l.$filters.date(s.create_at)),1),e("td",null,[s.user?(i(),r("span",{key:0,textContent:o(s.user.email)},null,8,Ee)):y("",!0)]),e("td",null,[e("ul",Te,[(i(!0),r(p,null,v(s.products,_=>(i(),r("li",{key:_.id},o(_.product.title)+" 數量："+o(_.qty)+" "+o(_.product.unit),1))),128))])]),e("td",Ue,o(l.$filters.currency(s.total)),1),e("td",null,[e("div",Be,[w(e("input",{id:s.id,"onUpdate:modelValue":_=>s.is_paid=_,type:"checkbox",role:"switch",class:"form-check-input",onChange:_=>c.updateOrder(s)},null,40,Ie),[[L,s.is_paid]]),e("label",{class:"form-check-label",for:s.id},[s.is_paid?(i(),r("span",{key:0,class:P({"text-success":s.is_paid,"font-weight-bold":s.is_paid})},o(s.is_paid?"已付款":"尚未付款"),3)):y("",!0)],8,je)])]),e("td",null,[e("div",qe,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:_=>c.openModal("edit",s)}," 檢視 ",8,Ne),e("button",{class:"btn btn-outline-danger btn-sm",onClick:_=>c.openModal("del",s),type:"button"}," 刪除 ",8,Fe)])])],2)):y("",!0)],64))),128))])])]),O(m,{pages:t.pagination,onChangePage:c.getOrders},null,8,["pages","onChangePage"]),O(b,{ref:"orderModal",onUpdateOrder:c.updateOrder,order:t.tempOrder,"is-processing":t.isProcessing},null,8,["onUpdateOrder","order","is-processing"]),O(g,{ref:"delOrderModal",onDelOrder:c.delOrder,"is-processing":t.isProcessing,order:t.tempOrder},null,8,["onDelOrder","is-processing","order"])])}const Ge=x(Le,[["render",He]]);export{Ge as default};
