import{T as p}from"./Toast-b9bbccda.js";import{m as $,A as x}from"./modalMixin-d49fdef1.js";import{_ as M,o as c,c as u,b as e,j as r,v as h,G as k,q as V,e as v,t as m,r as b,d as g,F as D,l as L}from"./index-023633a6.js";const T={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{},tempCoupon:{},due_date:""}},mixins:[$],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{}},A={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog",role:"document"},U={class:"modal-content"},E={class:"modal-header"},B={class:"modal-title",id:"exampleModalLabel"},I={key:0},O={key:1},S=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},F={class:"mb-3"},H=e("label",{for:"title"},"標題",-1),R={class:"mb-3"},q=e("label",{for:"coupon_code"},"優惠碼",-1),G={class:"mb-3"},z=e("label",{for:"due_date"},"到期日",-1),J={class:"mb-3"},K=e("label",{for:"price"},"折扣百分比",-1),Q={class:"mb-3"},W={class:"form-check"},X=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Y={class:"modal-footer"},Z=e("button",{type:"button",class:"btn btn-gray","data-bs-dismiss":"modal"}," Close ",-1),ee=["disabled"],oe={key:0,class:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"};function te(s,o,n,l,t,d){return c(),u("div",A,[e("div",N,[e("div",U,[e("div",E,[e("h5",B,[n.isNew?(c(),u("span",I,"新增優惠卷")):(c(),u("span",O,"編輯優惠卷"))]),S]),e("div",j,[e("div",F,[H,r(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=i=>t.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[h,t.tempCoupon.title]])]),e("div",R,[q,r(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=i=>t.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[h,t.tempCoupon.code]])]),e("div",G,[z,r(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=i=>t.due_date=i)},null,512),[[h,t.due_date]])]),e("div",J,[K,r(e("input",{type:"number",class:"form-control",id:"price",min:"0",max:"100","onUpdate:modelValue":o[3]||(o[3]=i=>t.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[h,t.tempCoupon.percent,void 0,{number:!0}]])]),e("div",Q,[e("div",W,[r(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=i=>t.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[k,t.tempCoupon.is_enabled]]),X])])]),e("div",Y,[Z,e("button",{type:"button",class:"btn btn-primary",disabled:n.isProcessing,onClick:o[5]||(o[5]=i=>s.$emit("update-coupon",t.tempCoupon))},[n.isProcessing?(c(),u("span",oe)):V("",!0),v(" "+m(n.isNew?"新增優惠卷":"更新優惠券"),1)],8,ee)])])])],512)}const se=M(T,[["render",te]]),ne={props:{coupon:{type:Object,default(){return{}}},isProcessing:{type:Boolean,default:!1}},data(){return{modal:{}}},mixins:[$]},ie={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},le={class:"modal-dialog"},de={class:"modal-content border-0"},ae=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delProductModalLabel",class:"modal-title"},[e("span",null,"刪除優惠卷")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ce={class:"modal-body"},ue={class:"text-danger"},pe={class:"modal-footer"},re=e("button",{type:"button",class:"btn btn-outline-gray","data-bs-dismiss":"modal"}," 取消 ",-1),me=["disabled"];function _e(s,o,n,l,t,d){return c(),u("div",ie,[e("div",le,[e("div",de,[ae,e("div",ce,[v(" 是否刪除 "),e("strong",ue,m(n.coupon.title),1),v(" 優惠卷(刪除後將無法恢復)。 ")]),e("div",pe,[re,e("button",{type:"button",class:"btn btn-danger",disabled:n.isProcessing,onClick:o[0]||(o[0]=i=>s.$emit("del-coupon"))}," 確認刪除 ",8,me)])])])],512)}const he=M(ne,[["render",_e]]),{VITE_API:f,VITE_PATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"coffee11",BASE_URL:"/cafe_backend/",MODE:"production",DEV:!1,PROD:!0},be={data(){return{coupons:[],tempCoupon:{},couponDate:"",pagination:{},isNew:!1,isLoading:!1,isProcessing:!1}},components:{AdminPagination:x,CouponModal:se,DelCouponModal:he},methods:{getCoupons(s=1){this.isLoading=!0,this.$http.get(`${f}/api/${C}/admin/coupons?page=${s}`).then(o=>{const{coupons:n,pagination:l}=o.data;this.isLoading=!1,this.coupons=n,this.pagination=l}).catch(o=>{var l,t;const n=((t=(l=o.response)==null?void 0:l.data)==null?void 0:t.message)||"資料錯誤，稍後在試";this.isLoading=!1,p.fire({title:`${n}`,icon:"error"})})},openModal(s,o){s==="new"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:0},this.$refs.couponModal.showModal()):s==="edit"?(this.tempCoupon={...o},this.$refs.couponModal.showModal()):s==="del"&&(this.tempCoupon={...o},this.$refs.delCouponModal.showModal())},updateCoupon(s){let o=s,n="post",l=`${f}/api/${C}/admin/coupon`;this.isNew||(n="put",l=`${f}/api/${C}/admin/coupon/${this.tempCoupon.id}`,o=this.tempCoupon),this.isProcessing=!0,this.$http[n](l,{data:o}).then(t=>{p.fire({title:`${t.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.couponModal.hideModal(),this.getCoupons()}).catch(t=>{var i,_;this.isProcessing=!1;const d=((_=(i=t.response)==null?void 0:i.data)==null?void 0:_.message)||"資料錯誤";p.fire({title:`${d}`,icon:"error"})})},delCoupon(){this.isProcessing=!0,this.$http.delete(`${f}/api/${C}/admin/coupon/${this.tempCoupon.id}`).then(s=>{p.fire({title:`${s.data.message}`,icon:"success"}),this.isProcessing=!1,this.$refs.delCouponModal.hideModal(),this.getCoupons()}).catch(s=>{var n,l;this.isProcessing=!1;const o=((l=(n=s.response)==null?void 0:n.data)==null?void 0:l.message)||"資料錯誤";p.fire({title:`${o}`,icon:"error"})})}},mounted(){this.getCoupons()}},ge={class:"text-end mt-4"},fe=["disabled"],Ce={class:"table-responsive"},ve={class:"table mt-4"},Me=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),$e={key:0,class:"text-success"},ye={key:1,class:"text-muted"},Pe={class:"btn-group"},we=["onClick"],xe=["onClick"];function ke(s,o,n,l,t,d){const i=b("VueLoading"),_=b("AdminPagination"),y=b("CouponModal"),P=b("DelCouponModal");return c(),u("div",null,[g(i,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=a=>t.isLoading=a)},null,8,["active"]),e("div",ge,[e("button",{class:"btn btn-primary",type:"button",disabled:t.isProcessing,onClick:o[1]||(o[1]=a=>d.openModal("new"))}," 建立新的優惠券 ",8,fe)]),e("div",Ce,[e("table",ve,[Me,e("tbody",null,[(c(!0),u(D,null,L(t.coupons,a=>(c(),u("tr",{key:a.id},[e("td",null,m(a.title),1),e("td",null,m(a.percent)+"%",1),e("td",null,m(s.$filters.date(a.due_date)),1),e("td",null,[a.is_enabled===1?(c(),u("span",$e,"啟用")):(c(),u("span",ye,"未啟用"))]),e("td",null,[e("div",Pe,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:w=>d.openModal("edit",a)}," 編輯 ",8,we),e("button",{class:"btn btn-outline-danger btn-sm",onClick:w=>d.openModal("del",a)}," 刪除 ",8,xe)])])]))),128))])]),g(_,{pages:t.pagination,onChangePage:d.getCoupons},null,8,["pages","onChangePage"]),g(y,{ref:"couponModal",coupon:t.tempCoupon,"is-new":t.isNew,"is-processing":t.isProcessing,onUpdateCoupon:d.updateCoupon},null,8,["coupon","is-new","is-processing","onUpdateCoupon"]),g(P,{ref:"delCouponModal",coupon:t.tempCoupon,"is-processing":t.isProcessing,onDelCoupon:d.delCoupon},null,8,["coupon","is-processing","onDelCoupon"])])])}const Te=M(be,[["render",ke]]);export{Te as default};
